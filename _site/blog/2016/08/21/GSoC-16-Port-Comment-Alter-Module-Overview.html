<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Anchal - GSoC'16 - Port Comment Alter Module - Overview</title>
  <meta name="author" content="Anchal" />
  <meta name="description" content="The blog of Anchal" />
  <link rel="canonical" href="https://anchal29.github.io/blog/2016/08/21/GSoC-16-Port-Comment-Alter-Module-Overview.html" />

  <link href="//fonts.googleapis.com/css?family=Open+Sans:600,800" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" href="/favicon.png">
  <link rel="alternate" type="application/atom+xml" title="Anchal" href="https://anchal29.github.io/atom.xml" />

  <link rel="stylesheet" href="/assets/css/all.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha256-k2/8zcNbxVIh5mnQ52A0r3a6jAgMGxFJFE2707UxGCk= sha512-ZV9KawG2Legkwp3nAlxLIVFudTauWuBpC10uEafMHYL0Sarrz5A7G79kXh5+5+woxQ5HM559XX2UZjMJ36Wplg==" crossorigin="anonymous">
</head>
<body>
  <div class="container">
    <div class="four columns sidebar">
      <nav>
  <h1>Hi.</h1>
  <a href="/">
    
    <img src="/logo.png" id="logo" alt="Blog logo"/>
    
  </a>
  <h2>I'm <a href="/">Anchal</a>.</h2>
  <div id="bio">
    <p style="text-align: center;">Drupal, GSoC and anime</p>
  </div>
  <div id="social">
    Follow me:
<div id="stalker">
  
  <a title="anchal29 on Github" href="https://github.com/anchal29">
    <i class="fa fa-github-square"></i>
  </a>
  

  

  

  

  

  

  
  <a title="Anchal on Facebook" href="https://facebook.com/anchal.pandey.186">
    <i class="fa fa-facebook-square"></i>
  </a>
  

  

  

  

  

  
  <a title="Atom feed" id="atom" href="/atom.xml">
    <i class="fa fa-rss-square"></i>
  </a>
  
</div>

  </div>
</nav>

    </div>

    <div class="eleven columns content">
      <p class="meta">
  August 21, 2016
  <a href="/">
    <i class="home fa fa-home"></i>
  </a>
</p>

<h1 class="title">GSoC'16 - Port Comment Alter Module - Overview</h1>

<div id="post">
  <hr />

<p>For the last 3 months I’ve been working on <strong>Porting the Comment Alter module to Drupal 8</strong> as my GSoC’16 project under mentorship of <a href="https://www.drupal.org/u/boobaa">boobaa</a> and <a href="https://www.drupal.org/u/czigor">czigor</a>. This blog is an excerpt of the work I did during this time period. Weekly blog posts for the past 12 weeks can be accessed <a href="https://anchal29.github.io">here</a>.</p>

<h2 id="achievements">Achievements</h2>

<p><strong>Creating schema for the module:</strong> Implemented <code class="highlighter-rouge">hook_schema()</code> to store the old and new entity revision IDs along with the parent entity type as altered by a comment. The revision IDs are used to show the differences over comments. The parent entity type is used to delete the entries from the comment_alter table when any revision of the parent entity is deleted, because in Drupal 8 we can have same revision IDs from different entity types. So to remove entries of particular entity type we need the entity type.</p>

<p><strong>Using ThirdPartySettings to alter field config edit form -</strong> Implemented <code class="highlighter-rouge">hook_form_FORM_ID_alter()</code> for <code class="highlighter-rouge">field_config_edit_form</code>. This provides an interface to:</p>

<ol>
  <li>
    <p><strong>Make any field comment alterable -</strong> Makes it possible to select any field we want to be altered by the comment. Currently all the Drupal core provided fields works well with the module.</p>
  </li>
  <li>
    <p><strong>Hide alteration from diff -</strong> If the comment alterable option is enabled, then this option hides the differences shown over the comments. Instead of the differences, a link to the revision comparison is displayed for nodes. For the rest of the entities a “Changes are hidden” message is shown.</p>
  </li>
  <li>
    <p><strong>Use latest revision -</strong> When a module like Workbench makes the current revision of an entity not the latest one, this option forces the Comment Alter module to use the latest revision instead of the current one. This option is present on the comment field settings.</p>
  </li>
  <li>
    <p><strong>Adds Diff link on comments -</strong> Adds a Diff link on comments which takes us to the comparison page of two revisions, generated by the Diff module.</p>
  </li>
  <li>
    <p><strong>Comment altering while replying to a comment -</strong> By default comment alterable fields can not be altered while replying to a comment. This option allows altering of fields even while replying to comments.</p>
  </li>
</ol>

<p><strong>Adding pseudo fields:</strong> Implemented <code class="highlighter-rouge">hook_entity_extra_field_info()</code> to add one pseudo field for each comment alterable field on respective comment form display, and one pseudo field on comment display to show the changes made at the comment. Using these pseudo fields the position of the comment alterable fields can be re-ordered in the comment form. This gives site-builders flexibility to alter the position of any alterable fields.</p>

<p><strong>Attaching comment alterable fields’ widgets on comment form:</strong> Comment alterable field widgets are retrieved from the form-display of the parent entity and they are attached to the comment form only after ensuring that there are no side effects. To support same name fields on both comment and parent entity, <code class="highlighter-rouge">#parent</code> property is provided so that the submitted field values for our alterable field widgets appears at a different location, not at the top level of <code class="highlighter-rouge">$form_state-&gt;getValues()</code>. All these added fields are re-orderable. Column informations and old values are also stored to the form at this stage, to later check if there were any changes made on the comment alterable fields.</p>

<p><strong>Adding submit and validation callback for the altered comment form:</strong> First the submitted values are checked against the old values to see if the values of the alterable field changed at all or not. If they changed, then the parent entity values are updated and this is done by building the parent entity form display and copying the altered field values into it. Then the form is saved. In case the parent entity doesn’t support revisions, then do nothing else just save the parent entity with altered values. Otherwise create a revision and store the comment ID, old and new revision IDs and parent entity type in the comment alter database table, which is used to show the differences on comments using the Diff module.</p>

<p><strong>Showing differences on comments:</strong> Using the Diff module and comment alter database table, the differences are shown over a particular comment. Only possible if the parent entity supports revisions. Diff module is used to get the differences between the two revisions and then those differences are rendered on comments in table format along with some custom styling.</p>

<p><strong>Adding PHPUnit tests:</strong> Added automated unit tests to check the functionality of the module for different field types and widgets. The tests are written for EntityTestRev entity types to keep them as generic as possible. This was the toughest part for me as I was stuck at some places in tests for quite a while as thses tests took lot of time to run and debugging them really is hard. But in the end I’m happy that I was able to complete all the tests.</p>

<p><strong>Screencast/Demo video:</strong> Created a <a href="https://www.youtube.com/watch?v=9ZJqlbrPwxY">demo video</a> showing how the Comment Alter module works, along with a simple use case.</p>

<h2 id="whats-left">What’s left?</h2>
<p>My mentors asked me to skip the Rules Integration part because the Rules module doesn’t have a stable or a beta release yet, only their first alpha release is there. So, the Rules Integration part is postponed till we get a stable or beta release.</p>

<h2 id="some-important-links">Some important links</h2>

<ul>
  <li>
    <p>My <a href="https://github.com/anchal29/comment_alter">GitHub repo</a> contains all the <a href="https://github.com/anchal29/comment_alter/commits/8.x">commits</a> which I made during this project</p>
  </li>
  <li>
    <p>The <a href="https://www.drupal.org/project/comment_alter">Comment Alter module’s project page</a> on drupal.org</p>
  </li>
</ul>

<p>Thank you!</p>

</div>


<div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'anchal29';
        var disqus_identifier = "/blog/2016/08/21/GSoC-16-Port-Comment-Alter-Module-Overview.html";
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


<div id="related">
  <h3>Related Posts</h3>
  <ul class="posts">
    
    <li>
      <span>17 Aug 2016 &raquo;</span> <a href="/blog/2016/08/17/GSoC-16-Port-Comment-Alter-Module-Week-12.html">GSoC'16 - Port Comment Alter Module - Week 12</a>
    </li>
    
    <li>
      <span>08 Aug 2016 &raquo;</span> <a href="/blog/2016/08/08/GSoC-16-Port-Comment-Alter-Module-Week-11.html">GSoC'16 - Port Comment Alter Module - Week 11</a>
    </li>
    
    <li>
      <span>03 Aug 2016 &raquo;</span> <a href="/blog/2016/08/03/GSoC-16-Port-Comment-Alter-Module-Week-10.html">GSoC'16 - Port Comment Alter Module - Week 10</a>
    </li>
    
  </ul>
</div>


      <div class="footer">
        <div class="disclaimer">
  

  <p>
    © Anchal, 2016 &mdash; built with <a href="http://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/swanson/lagom">Lagom theme</a>
  </p>
</div>

      </div>
    </div>
  </div>


<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-xxxx-x']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>
</html>
